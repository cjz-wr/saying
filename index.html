<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <title>每日一句名言</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: '微软雅黑', Arial, sans-serif;
            background: linear-gradient(135deg, #ffe3b3 0%, #ffd6a0 100%);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            animation: bgMove 8s ease-in-out infinite alternate;
            background-size: 200% 200%;
        }
        @keyframes bgMove {
            0% {
                background-position: 0% 50%;
            }
            100% {
                background-position: 100% 50%;
            }
        }
        .container {
            max-width: 600px;
            margin: 80px auto;
            background: rgba(255,255,255,0.97);
            border-radius: 18px;
            box-shadow: 0 8px 32px 0 rgba(255, 140, 0, 0.13);
            padding: 48px 36px 40px 36px;
            transition: box-shadow 0.3s;
            position: relative;
            overflow: hidden;
            animation: fadeInUp 1s cubic-bezier(.39,.575,.565,1.000);
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .content, .author, .source {
            transition: opacity 0.5s, transform 0.5s;
        }
        .fade-out {
            opacity: 0 !important;
            transform: translateY(20px) scale(0.98) !important;
        }
        .fade-in {
            opacity: 1 !important;
            transform: translateY(0) scale(1) !important;
        }
        .content {
            font-size: 1.7em;
            color: #b85c00;
            margin-bottom: 32px;
            line-height: 1.6;
            text-align: center;
            letter-spacing: 1px;
            min-height: 80px;
        }
        .author {
            text-align: right;
            color: #ff9800;
            font-size: 1.15em;
            font-weight: bold;
            margin-bottom: 4px;
        }
        .source {
            text-align: right;
            color: #ffb74d;
            font-size: 1em;
            margin-bottom: 10px;
        }
        .btn {
            display: block;
            margin: 36px auto 0;
            padding: 12px 38px;
            font-size: 1.1em;
            background: linear-gradient(90deg, #ff9800 0%, #ffb74d 100%);
            color: #fff;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            box-shadow: 0 2px 8px #ffd6a0;
            transition: background 0.3s, transform 0.2s, box-shadow 0.3s;
            font-weight: bold;
            letter-spacing: 2px;
            outline: none;
        }
        .btn:hover {
            background: linear-gradient(90deg, #ffb74d 0%, #ff9800 100%);
            transform: translateY(-2px) scale(1.04);
            box-shadow: 0 6px 18px #ffd6a0;
        }
        .btn:active {
            transform: scale(0.96);
        }
        .particle {
            position: absolute;
            pointer-events: none;
            border-radius: 50%;
            width: 8px;
            height: 8px;
            background: linear-gradient(135deg, #ff9800 60%, #ffd6a0 100%);
            opacity: 0.8;
            z-index: 10;
            animation: particle-explode 0.7s forwards;
        }
        @keyframes particle-explode {
            to {
                opacity: 0;
                transform: translate(var(--tx), var(--ty)) scale(0.7) rotate(360deg);
            }
        }
        .content-wrapper {
            position: relative;
            min-height: 80px;
        }
        .char {
            display: inline-block;
            transition: transform 0.8s cubic-bezier(.6,-0.28,.74,.05), opacity 0.8s;
            will-change: transform, opacity;
            z-index: 20;
            position: relative;
        }
        .char-explode {
            opacity: 0;
            transform: translate(var(--tx), var(--ty)) scale(0.4) rotate(var(--rot));
        }
        @media (max-width: 700px) {
            .container { padding: 24px 8px 24px 8px; }
            .content { font-size: 1.2em; }
            .btn { padding: 10px 18px; font-size: 1em; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="content-wrapper">
            <div class="content" id="content"></div>
        </div>
        <div class="author" id="author"></div>
        <div class="source" id="source"></div>
        <button class="btn" onclick="showRandomQuote()">换一句</button>
    </div>
    <script>
    let quotes = [];
    fetch('merged.json')
      .then(r => {
        if (!r.ok) throw new Error('无法加载名言数据');
        return r.json();
      })
      .then(data => {
        quotes = data.filter(q => q && q.content);
        showRandomQuote();
      })
      .catch(e => {
        document.getElementById('content').innerText = '名言数据加载失败，请刷新或联系站长！';
        document.getElementById('author').innerText = '';
        document.getElementById('source').innerText = '';
      });
    function createParticles() {
      const wrapper = document.querySelector('.content-wrapper');
      const rect = wrapper.getBoundingClientRect();
      const count = 24;
      for (let i = 0; i < count; i++) {
        const p = document.createElement('div');
        p.className = 'particle';
        // 随机角度和距离
        const angle = Math.random() * 2 * Math.PI;
        const distance = 60 + Math.random() * 40;
        const tx = Math.cos(angle) * distance;
        const ty = Math.sin(angle) * distance;
        p.style.setProperty('--tx', tx + 'px');
        p.style.setProperty('--ty', ty + 'px');
        // 随机初始位置在内容区域中心
        p.style.left = (rect.width / 2 - 4) + 'px';
        p.style.top = (rect.height / 2 - 4) + 'px';
        p.style.background = `linear-gradient(135deg, #ff9800 ${(60+Math.random()*30)}%, #ffd6a0 100%)`;
        wrapper.appendChild(p);
        setTimeout(() => p.remove(), 700);
      }
    }
    function wrapChars(text) {
      // 将每个字符用 span.char 包裹
      return text.split('').map((ch, i) => `<span class="char" data-idx="${i}">${ch === ' ' ? '&nbsp;' : ch}</span>`).join('');
    }
    function explodeChars(callback) {
      const content = document.getElementById('content');
      const wrapper = document.querySelector('.content-wrapper');
      const chars = Array.from(content.querySelectorAll('.char'));
      // 计算每个字的绝对位置
      const contentRect = content.getBoundingClientRect();
      const wrapperRect = wrapper.getBoundingClientRect();
      chars.forEach((span, i) => {
        const rect = span.getBoundingClientRect();
        // 计算相对于 wrapper 的位置
        const left = rect.left - wrapperRect.left;
        const top = rect.top - wrapperRect.top;
        // 变为绝对定位
        span.style.position = 'absolute';
        span.style.left = left + 'px';
        span.style.top = top + 'px';
        span.style.width = rect.width + 'px';
        span.style.height = rect.height + 'px';
      });
      // 让 content 清空，chars 直接挂到 wrapper 上
      content.innerHTML = '';
      chars.forEach(span => wrapper.appendChild(span));
      // 强制重绘
      chars.forEach(span => span.offsetWidth);
      // 爆炸动画
      chars.forEach((span, i) => {
        const angle = Math.random() * 2 * Math.PI;
        const distance = 90 + Math.random() * 60;
        const tx = Math.cos(angle) * distance;
        const ty = Math.sin(angle) * distance;
        const rot = (Math.random() * 1080 - 540) + 'deg';
        span.style.setProperty('--tx', tx + 'px');
        span.style.setProperty('--ty', ty + 'px');
        span.style.setProperty('--rot', rot);
        span.classList.add('char-explode');
      });
      setTimeout(() => {
        // 移除所有爆炸字
        chars.forEach(span => span.remove());
        callback();
      }, 800);
    }
    function animateQuoteChange(newQuote) {
      const content = document.getElementById('content');
      const wrapper = document.querySelector('.content-wrapper');
      if (content.innerHTML.trim()) {
        explodeChars(() => {
          content.innerHTML = wrapChars(newQuote.content);
          // 新字弹入
          const chars = content.querySelectorAll('.char');
          chars.forEach((span, i) => {
            span.style.opacity = '0';
            span.style.transform = 'scale(0.4)';
            setTimeout(() => {
              span.style.transition = 'transform 0.5s, opacity 0.5s';
              span.style.opacity = '1';
              span.style.transform = 'scale(1)';
            }, 30 * i);
          });
        });
      } else {
        // 首次加载
        content.innerHTML = wrapChars(newQuote.content);
        const chars = content.querySelectorAll('.char');
        chars.forEach((span, i) => {
          span.style.opacity = '0';
          span.style.transform = 'scale(0.4)';
          setTimeout(() => {
            span.style.transition = 'transform 0.5s, opacity 0.5s';
            span.style.opacity = '1';
            span.style.transform = 'scale(1)';
          }, 30 * i);
        });
      }
      // 作者和出处淡入淡出动画不变
      const author = document.getElementById('author');
      const source = document.getElementById('source');
      author.classList.remove('fade-in');
      source.classList.remove('fade-in');
      author.classList.add('fade-out');
      source.classList.add('fade-out');
      setTimeout(() => {
        author.innerText = newQuote.author ? '—— ' + newQuote.author : '';
        source.innerText = newQuote.source ? '《' + newQuote.source + '》' : '';
        author.classList.remove('fade-out');
        source.classList.remove('fade-out');
        author.classList.add('fade-in');
        source.classList.add('fade-in');
      }, 350);
    }
    function showRandomQuote() {
      if (!quotes.length) return;
      const q = quotes[Math.floor(Math.random() * quotes.length)];
      animateQuoteChange(q);
    }
    </script>
</body>
</html>
